"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3180],{3180:(D,A,r)=>{r.r(A),r.d(A,{ManageAnnouncementsPageModule:()=>Y});var _=r(6814),l=r(6223),c=r(451),f=r(8179),M=r(5861),n=r(9212),v=r(6530),Z=r(82),b=r(8859);const y=["modal"];function P(o,a){if(1&o){const t=n.EpF();n.TgZ(0,"form",null,13)(2,"div",14)(3,"p",15),n._uU(4," Share what you want to say "),n.qZA(),n.TgZ(5,"div",16)(6,"ion-text"),n._uU(7,"Write your announcement"),n.qZA(),n.TgZ(8,"ion-textarea",17),n.NdJ("ngModelChange",function(i){n.CHM(t);const s=n.oxw();return n.KtG(s.description=i)}),n._UZ(9,"ion-icon",18),n.qZA()(),n.TgZ(10,"div",19)(11,"ion-text"),n._uU(12,"Specify who will see your announcement"),n.qZA(),n.TgZ(13,"ion-select",20),n.NdJ("ngModelChange",function(i){n.CHM(t);const s=n.oxw();return n.KtG(s.visibilitySelectedOption=i)}),n.TgZ(14,"ion-select-option",21),n._uU(15,"Dispatchers"),n.qZA(),n.TgZ(16,"ion-select-option",22),n._uU(17,"Medics"),n.qZA(),n.TgZ(18,"ion-select-option",23),n._uU(19,"Board members"),n.qZA(),n._UZ(20,"ion-icon",24),n.qZA()(),n.TgZ(21,"div",25)(22,"ion-text"),n._uU(23,"Specify its importance level"),n.qZA(),n.TgZ(24,"ion-select",26),n.NdJ("ngModelChange",function(i){n.CHM(t);const s=n.oxw();return n.KtG(s.importanceSelectedOption=i)}),n.TgZ(25,"ion-select-option",27),n._uU(26,"Very important"),n.qZA(),n.TgZ(27,"ion-select-option",28),n._uU(28,"Important"),n.qZA(),n.TgZ(29,"ion-select-option",29),n._uU(30,"Regular"),n.qZA(),n._UZ(31,"ion-icon",30),n.qZA()(),n.TgZ(32,"div",31)(33,"ion-button",32),n.NdJ("click",function(){n.CHM(t);const i=n.oxw();return n.KtG(i.dismiss())}),n._uU(34,"Cancel"),n.qZA(),n.TgZ(35,"ion-button",33),n.NdJ("click",function(){n.CHM(t);const i=n.oxw();return n.KtG(i.addAnnouncement())}),n._uU(36,"Send"),n.qZA()()()()}if(2&o){const t=n.MAs(1),e=n.oxw();n.xp6(8),n.Q6J("ngModel",e.description)("autoGrow",!0),n.xp6(5),n.Q6J("ngModel",e.visibilitySelectedOption)("multiple",!0),n.xp6(11),n.Q6J("ngModel",e.importanceSelectedOption),n.xp6(11),n.Q6J("disabled",t.invalid)}}function C(o,a){if(1&o&&(n.ynx(0),n.TgZ(1,"ion-chip",49),n._uU(2),n.qZA(),n.BQk()),2&o){const t=n.oxw().$implicit;n.xp6(2),n.Oqu(t.importance)}}function O(o,a){if(1&o&&(n.ynx(0),n.TgZ(1,"ion-chip",50),n._uU(2),n.qZA(),n.BQk()),2&o){const t=n.oxw().$implicit;n.xp6(2),n.Oqu(t.importance)}}function T(o,a){if(1&o&&(n.ynx(0),n.TgZ(1,"ion-chip",51),n._uU(2),n.qZA(),n.BQk()),2&o){const t=n.oxw().$implicit;n.xp6(2),n.Oqu(t.importance)}}function w(o,a){if(1&o){const t=n.EpF();n.TgZ(0,"div",38),n.NdJ("click",function(){const s=n.CHM(t).$implicit,d=n.oxw(2);return n.KtG(d.openModal(s))}),n.TgZ(1,"div",39)(2,"ion-avatar",40),n._UZ(3,"img",41),n.qZA()(),n.TgZ(4,"div",42)(5,"div",43)(6,"h2",44),n._uU(7),n.qZA(),n.YNc(8,C,3,1,"ng-container",12)(9,O,3,1,"ng-container",12)(10,T,3,1,"ng-container",12),n.qZA(),n.TgZ(11,"div",45)(12,"p",46),n._uU(13),n.qZA()(),n.TgZ(14,"div",47)(15,"h3",48),n._uU(16),n.qZA()()()()}if(2&o){const t=a.$implicit,e=n.oxw(2);n.xp6(7),n.AsE("",t.admin.first_name," ",t.admin.last_name,""),n.xp6(),n.Q6J("ngIf","Very important"==t.importance),n.xp6(),n.Q6J("ngIf","Important"==t.importance),n.xp6(),n.Q6J("ngIf","Regular"==t.importance),n.xp6(3),n.hij(" ",e.truncateDescription(t.description,65)," "),n.xp6(3),n.Q0o("Sent to ",1==t.visible_to?"dispatchers":""," ",2==t.visible_to?"medics":""," ",3==t.visible_to?"admins":""," ",4==t.visible_to?"medics & admins":""," ",5==t.visible_to?"dispatchers & admins":""," ",6==t.visible_to?"dispatchers & medics":""," ",e.formatDate(t.created_at)," ")}}function q(o,a){if(1&o&&(n.ynx(0),n.TgZ(1,"ion-chip",49),n._uU(2),n.qZA(),n.BQk()),2&o){const t=n.oxw(3);n.xp6(2),n.Oqu(t.selectedAnnouncement.importance)}}function S(o,a){if(1&o&&(n.ynx(0),n.TgZ(1,"ion-chip",50),n._uU(2),n.qZA(),n.BQk()),2&o){const t=n.oxw(3);n.xp6(2),n.Oqu(t.selectedAnnouncement.importance)}}function k(o,a){if(1&o&&(n.ynx(0),n.TgZ(1,"ion-chip",51),n._uU(2),n.qZA(),n.BQk()),2&o){const t=n.oxw(3);n.xp6(2),n.Oqu(t.selectedAnnouncement.importance)}}function U(o,a){if(1&o){const t=n.EpF();n.TgZ(0,"div",14)(1,"div",52)(2,"div",39)(3,"ion-avatar",40),n._UZ(4,"img",41),n.qZA()(),n.TgZ(5,"div",42)(6,"div",43)(7,"h2",44),n._uU(8),n.qZA(),n.YNc(9,q,3,1,"ng-container",12)(10,S,3,1,"ng-container",12)(11,k,3,1,"ng-container",12),n.qZA(),n.TgZ(12,"div",45)(13,"p",46),n._uU(14),n.qZA()(),n.TgZ(15,"div",47)(16,"h3",48),n._uU(17),n.qZA(),n.TgZ(18,"ion-icon",53),n.NdJ("click",function(){n.CHM(t);const i=n.oxw(2);return n.KtG(i.deleteAlert())}),n.qZA()()()()()}if(2&o){const t=n.oxw(2);n.xp6(8),n.AsE("",t.selectedAnnouncement.admin.first_name," ",t.selectedAnnouncement.admin.last_name,""),n.xp6(),n.Q6J("ngIf","Very important"==t.selectedAnnouncement.importance),n.xp6(),n.Q6J("ngIf","Important"==t.selectedAnnouncement.importance),n.xp6(),n.Q6J("ngIf","Regular"==t.selectedAnnouncement.importance),n.xp6(3),n.Oqu(t.selectedAnnouncement.description),n.xp6(3),n.Oqu(t.formatDate(t.selectedAnnouncement.created_at))}}function J(o,a){if(1&o&&(n.ynx(0),n.TgZ(1,"div",34),n.YNc(2,w,17,13,"div",35),n.qZA(),n.TgZ(3,"ion-modal",36,37),n.YNc(5,U,19,7,"ng-template"),n.qZA(),n.BQk()),2&o){const t=n.oxw();n.xp6(2),n.Q6J("ngForOf",t.myAnnouncements)}}function I(o,a){1&o&&(n.ynx(0),n.TgZ(1,"div",54),n._UZ(2,"ion-spinner",55),n.qZA(),n.BQk())}function Q(o,a){1&o&&(n.ynx(0),n.TgZ(1,"div",54)(2,"div",56)(3,"p"),n._uU(4,"No announcements"),n.qZA(),n.TgZ(5,"p",57),n._uU(6,"Announcements you send will appear here"),n.qZA(),n._UZ(7,"ion-img",58),n.qZA()(),n.BQk())}function N(o,a){if(1&o&&(n.ynx(0),n.YNc(1,I,3,0,"ng-container",12)(2,Q,8,0,"ng-container",12),n.BQk()),2&o){const t=n.oxw();n.xp6(),n.Q6J("ngIf",t.isLoading),n.xp6(),n.Q6J("ngIf",!t.isLoading)}}const F=[{path:"",component:(()=>{var o;class a{constructor(e,i,s,d,g,p,m){var u,h,x;this.router=e,this.modalController=i,this.alertController=s,this.userService=d,this.adminService=g,this.toastController=p,this.fcmService=m,this.announcements=[],this.myAnnouncements=[],this.userId=null!==(u=localStorage.getItem("user_id"))&&void 0!==u?u:"",this.firstName=null!==(h=localStorage.getItem("first_name"))&&void 0!==h?h:"",this.lastName=null!==(x=localStorage.getItem("last_name"))&&void 0!==x?x:"",this.visibilitySelectedOption="dispatchers",this.importanceSelectedOption="Very important",this.description="",this.isLoading=!1}ngOnInit(){this.myAnnouncements=[],this.getAllAnnouncements()}getAllAnnouncements(){this.isLoading=!0,this.userService.getAllAnnouncements().subscribe({next:e=>{if(e&&e.hasOwnProperty("announcements")){console.log("Fetched all announcements: ",e);const i=JSON.parse(JSON.stringify(e));this.announcements=[].concat.apply([],Object.values(i.announcements)),this.announcements.forEach(s=>{s.admin_id==this.userId&&this.myAnnouncements.push(s)})}else console.log("No announcements")},error:e=>{console.error("Error retrieving announcements:",e)},complete:()=>{this.isLoading=!1}})}truncateDescription(e,i){return e.length>i?e.slice(0,i)+"...":e}formatDate(e){const i=new Date,s=new Date(e),d=i.getTime()-s.getTime(),g=Math.round(d/6e4),p=Math.round(d/1e3),m=Math.round(g/60);if(p<60)return 1===p?"1 second ago":`${p} seconds ago`;if(g<60)return 1===g?"1 minute ago":`${g} minutes ago`;if(m<24)return 1===m?"1 hour ago":`${m} hours ago`;const u=Math.round(m/24);return 1===u?"1 day ago":`${u} days ago`}addAnnouncement(){this.adminService.addAnnouncement(this.userId,this.importanceSelectedOption,this.description,this.setVisibility(this.visibilitySelectedOption)).subscribe({next:()=>{this.presentToast("Announcement sent"),this.fcmService.notifyAnnouncementReceivers(this.firstName,this.lastName,this.importanceSelectedOption,this.description,this.setVisibility(this.visibilitySelectedOption)),this.dismiss(),this.ngOnInit()},error:e=>{console.error("Error adding announcement:",e)}})}setVisibility(e){return!e.includes("dispatchers")||e.includes("medics")||e.includes("admins")?e.includes("dispatchers")||!e.includes("medics")||e.includes("admins")?e.includes("dispatchers")||e.includes("medics")||!e.includes("admins")?!e.includes("dispatchers")&&e.includes("medics")&&e.includes("admins")?4:e.includes("dispatchers")&&!e.includes("medics")&&e.includes("admins")?5:e.includes("dispatchers")&&e.includes("medics")&&!e.includes("admins")?6:0:3:2:1}deleteAlert(){var e=this;return(0,M.Z)(function*(){yield(yield e.alertController.create({header:"Delete Announcement",subHeader:"Are you sure you want to permanently delete this announcement?",cssClass:"alert-dialog",buttons:[{text:"Cancel",role:"cancel",cssClass:"alert-button-cancel"},{text:"Delete",cssClass:"alert-button-ok-red",handler:()=>{e.deleteAnnouncement(e.selectedAnnouncement.id),e.dismiss(),e.ngOnInit()}}]})).present()})()}deleteAnnouncement(e){this.adminService.deleteAnnouncement(e).subscribe({next:()=>{this.presentToast("Announcement deleted")},error:i=>{console.error("Error deleting announcements:",i)}})}presentToast(e){var i=this;return(0,M.Z)(function*(){(yield i.toastController.create({message:e,duration:2e3,position:"bottom"})).present()})()}openModal(e){var i;this.selectedAnnouncement=e,null===(i=this.modal)||void 0===i||i.present()}send(){console.log(this.visibilitySelectedOption)}dismiss(){this.modalController.dismiss()}back(){this.router.navigate(["/admin-panel"])}}return(o=a).\u0275fac=function(e){return new(e||o)(n.Y36(f.F0),n.Y36(c.IN),n.Y36(c.Br),n.Y36(v.K),n.Y36(Z.l),n.Y36(c.yF),n.Y36(b.E))},o.\u0275cmp=n.Xpm({type:o,selectors:[["app-manage-announcements"]],viewQuery:function(e,i){if(1&e&&n.Gf(y,5),2&e){let s;n.iGM(s=n.CRH())&&(i.modal=s.first)}},decls:16,vars:2,consts:[["id","main-content"],[1,"header-toolbar"],[1,"toolbar-container"],["slot","start"],[3,"click"],["name","chevron-back-outline",1,"back-button"],[1,"title"],[1,"background"],["vertical","bottom","horizontal","end","slot","fixed"],["id","add-announcement"],["name","add"],["mode","ios","id","add-announcement-modal","trigger","add-announcement"],[4,"ngIf"],["announcementForm","ngForm"],[1,"wrapper"],[1,"statement"],[1,"announcement-container"],["placeholder","Announcement...","name","announcement","ngModel","","required","",3,"ngModel","autoGrow","ngModelChange"],["name","megaphone","slot","start",1,"modal-icon"],[1,"receiver-container"],["placeholder","Select Receiver","name","receiver","ngModel","","required","",3,"ngModel","multiple","ngModelChange"],["value","dispatchers"],["value","medics"],["value","admins"],["slot","start","name","people",1,"modal-icon"],[1,"importance-container"],["placeholder","Select Importance level","name","importance","ngModel","","required","",3,"ngModel","ngModelChange"],["value","Very important"],["value","Important"],["value","Regular"],["slot","start","name","alert-circle-sharp",1,"modal-icon"],[1,"buttons-container"],["fill","outline",1,"cancel-button",3,"click"],["fill","outline",1,"send-button",3,"disabled","click"],[1,"mainpage"],["class","announcement","id","announcement.id",3,"click",4,"ngFor","ngForOf"],["id","view-announcement-modal"],["modal",""],["id","announcement.id",1,"announcement",3,"click"],[1,"first-box"],["slot","start",1,"profile-picture"],["alt","Silhouette of a person's head","src","https://ionicframework.com/docs/img/demos/avatar.svg"],[1,"second-box"],[1,"name"],[1,"username"],[1,"description-container"],[1,"description"],[1,"time-posted"],[1,"time"],["color","danger"],["color","warning"],["color","success"],["id","announcement",1,"modal-announcement"],["name","trash-outline",1,"delete-icon",3,"click"],[1,"body"],["name","crescent"],[1,"stmt"],[1,"second-stmt"],["src","assets/img/no-emergencies-img.png",1,"no-emergencies-img"]],template:function(e,i){1&e&&(n.TgZ(0,"ion-header",0)(1,"ion-toolbar",1)(2,"div",2)(3,"ion-buttons",3)(4,"ion-button",4),n.NdJ("click",function(){return i.back()}),n._UZ(5,"ion-icon",5),n.qZA()(),n.TgZ(6,"ion-title",6),n._uU(7,"Your Announcements"),n.qZA()()()(),n.TgZ(8,"ion-content",7)(9,"ion-fab",8)(10,"ion-fab-button",9),n._UZ(11,"ion-icon",10),n.qZA()(),n.TgZ(12,"ion-modal",11),n.YNc(13,P,37,6,"ng-template"),n.qZA(),n.YNc(14,J,6,1,"ng-container",12)(15,N,3,2,"ng-container",12),n.qZA()),2&e&&(n.xp6(14),n.Q6J("ngIf",i.myAnnouncements.length>0),n.xp6(),n.Q6J("ngIf",0==i.myAnnouncements.length))},dependencies:[_.sg,_.O5,l._Y,l.JJ,l.JL,l.Q7,l.On,l.F,c.BJ,c.YG,c.Sm,c.hM,c.W2,c.IJ,c.W4,c.Gu,c.gu,c.Xz,c.t9,c.n0,c.PQ,c.yW,c.g2,c.wd,c.sr,c.ki,c.QI,c.j9],styles:[".header-toolbar[_ngcontent-%COMP%]{height:60px;display:flex;justify-content:center;align-items:center}.toolbar-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;align-items:center;padding:5px}.back-button[_ngcontent-%COMP%]{font-weight:400}.title[_ngcontent-%COMP%]{font-size:22px;font-weight:400}.mainpage[_ngcontent-%COMP%]{display:flex;flex-direction:column}.announcement[_ngcontent-%COMP%], .modal-announcement[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;border-bottom:1px solid gray}.announcement[_ngcontent-%COMP%]:active{opacity:.2}.first-box[_ngcontent-%COMP%]{flex-direction:row;display:flex;align-items:center;justify-content:center}.profile-picture[_ngcontent-%COMP%]{margin:15px;color:#837272;height:70px;width:70px}.second-box[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-right:10px;width:100%}.name[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.username[_ngcontent-%COMP%]{font-weight:700;font-size:18px}ion-chip[_ngcontent-%COMP%]{font-size:14px;height:50%;text-align:center;justify-content:space-between;align-items:flex-end;padding-right:10px}.ion-chip-critical[_ngcontent-%COMP%]{--background: #FF0000}.ion-chip-important[_ngcontent-%COMP%]{--background: #FF7A00}.ion-chip-regular[_ngcontent-%COMP%]{--background: #0BC813}.time-posted[_ngcontent-%COMP%]{margin:0;display:flex;justify-content:space-between}.time[_ngcontent-%COMP%]{opacity:.8;font-size:13px;font-weight:lighter;margin-top:10px;font-style:italic}.delete-icon[_ngcontent-%COMP%]{font-size:20px;margin:5px;opacity:.8}.delete-icon[_ngcontent-%COMP%]:active{opacity:.2}ion-fab-button[_ngcontent-%COMP%]{--background: #810808;--color: white;--background-activated: #380404;margin:5px}ion-modal#view-announcement-modal[_ngcontent-%COMP%]{--width: 96%;--min-width: 250px;--height: fit-content;--border-radius: 6px;--box-shadow: 0 28px 48px rgba(0, 0, 0, .4)}.description[_ngcontent-%COMP%]{margin:0;opacity:.8}ion-modal#add-announcement-modal[_ngcontent-%COMP%]{--width: 90%;--min-width: 250px;--height: fit-content;--border-radius: 6px;--box-shadow: 0 28px 48px rgba(0, 0, 0, .4)}ion-modal#add-announcement-modal[_ngcontent-%COMP%]   .wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:10px}.statement[_ngcontent-%COMP%]{font-weight:700;font-size:18px}.announcement-container[_ngcontent-%COMP%], .receiver-container[_ngcontent-%COMP%], .importance-container[_ngcontent-%COMP%]{padding:10px;width:100%}ion-select[_ngcontent-%COMP%], ion-textarea[_ngcontent-%COMP%]{border:1px solid gray;border-radius:10px;padding-right:10px}.modal-icon[_ngcontent-%COMP%]{font-size:25px;color:#810808;padding-left:10px}.buttons-container[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:10px;width:100%}.send-button[_ngcontent-%COMP%]{--border-color: #810808;--background-activated: #810808;--color-activated: white;width:50%}.cancel-button[_ngcontent-%COMP%]{--background-activated: #810808;--color-activated: white;width:50%}.body[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:space-evenly;margin-top:5em;padding:10px}.stmt[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding-top:1em;font-size:18px;font-weight:700}.second-stmt[_ngcontent-%COMP%]{margin-top:-1em;font-size:14px;text-align:center}.no-emergencies-img[_ngcontent-%COMP%]{width:80%}.no-results[_ngcontent-%COMP%]{font-style:italic}"]}),a})()}];let B=(()=>{var o;class a{}return(o=a).\u0275fac=function(e){return new(e||o)},o.\u0275mod=n.oAB({type:o}),o.\u0275inj=n.cJS({imports:[f.Bz.forChild(F),f.Bz]}),a})(),Y=(()=>{var o;class a{}return(o=a).\u0275fac=function(e){return new(e||o)},o.\u0275mod=n.oAB({type:o}),o.\u0275inj=n.cJS({imports:[_.ez,l.u5,c.Pc,B]}),a})()}}]);