<ion-header id="main-content">
  <ion-toolbar class="toolbar">
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title class="title">Announcements</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="background">
  <ng-container *ngIf="visibleAnnouncements.length > 0">
    <div class="mainpage">
      <div class="announcement" *ngFor = "let announcement of visibleAnnouncements"  id="announcement.id" (click)="openModal(announcement)">
        <div class="first-box">
          <ion-avatar slot="start" class="profile-picture">
            <img alt="Silhouette of a person's head" [src]="(announcement.admin.profile_picture && announcement.admin.profile_picture !== 'null') ? 
            'http://localhost:8000/storage/images/' + announcement.admin.profile_picture : 'https://ionicframework.com/docs/img/demos/avatar.svg'" 
            onerror="this.src='https://ionicframework.com/docs/img/demos/avatar.svg'"/>
          </ion-avatar>
        </div>
        <div class="second-box">
          <div class="name">
            <h2 class="username">{{announcement.admin.first_name}} {{announcement.admin.last_name}}</h2>
            <ng-container *ngIf="announcement.importance == 'Very important'">
              <ion-chip color="danger">{{announcement.importance}}</ion-chip>
            </ng-container>
            <ng-container *ngIf="announcement.importance == 'Important'">
              <ion-chip color="warning">{{announcement.importance}}</ion-chip>
            </ng-container>
            <ng-container *ngIf="announcement.importance == 'Regular'">
              <ion-chip color="success">{{announcement.importance}}</ion-chip>
            </ng-container>
          </div>
          <div class="description-container">
            <p class="description">
              {{ truncateDescription(announcement.description, 65) }}
            </p>
          </div>
          <div class="time-posted">
            <div *ngIf="userRank == 'Admin' || userRank == 'Medic & Admin' || userRank == 'Dispatcher & Admin'">
              <h3 class="time">
                Sent to
                {{ announcement.visible_to == 1 ? 'dispatchers' : '' }}
                {{ announcement.visible_to == 2 ? 'medics' : '' }}
                {{ announcement.visible_to == 3 ? 'admins' : '' }}
                {{ announcement.visible_to == 4 ? 'medics & admins' : '' }}
                {{ announcement.visible_to == 5 ? 'dispatchers & admins' : '' }}
                {{ announcement.visible_to == 6 ? 'dispatchers & medics' : '' }}
              </h3>
            </div>
            <h3 class="time">
              &nbsp;{{ formatDate(announcement.created_at) }}
            </h3>
          </div>
        </div>
  
        <ion-modal id="view-announcement-modal" #modal>
          <ng-template>
            <div class="wrapper">
              <div class="announcement">
                <div class="first-box">
                  <ion-avatar slot="start" class="profile-picture">
                    <img alt="Silhouette of a person's head" [src]="(selectedAnnouncement.admin.profile_picture && selectedAnnouncement.admin.profile_picture !== 'null') ? 
                    'http://localhost:8000/storage/images/' + selectedAnnouncement.admin.profile_picture : 'https://ionicframework.com/docs/img/demos/avatar.svg'" 
                    onerror="this.src='https://ionicframework.com/docs/img/demos/avatar.svg'"/>
                  </ion-avatar>
                </div>
                <div class="second-box">
                  <div class="name">
                    <h2 class="username">{{selectedAnnouncement.admin.first_name}} {{selectedAnnouncement.admin.last_name}}</h2>
                    <ng-container *ngIf="announcement.importance == 'Very important'">
                      <ion-chip color="danger">{{selectedAnnouncement.importance}}</ion-chip>
                    </ng-container>
                    <ng-container *ngIf="announcement.importance == 'Important'">
                      <ion-chip color="warning">{{selectedAnnouncement.importance}}</ion-chip>
                    </ng-container>
                    <ng-container *ngIf="announcement.importance == 'Regular'">
                      <ion-chip color="success">{{selectedAnnouncement.importance}}</ion-chip>
                    </ng-container>
                  </div>
                  <div class="description-container">
                    <p class="description">{{ selectedAnnouncement.description }}</p>
                  </div>
                  <div class="time-posted">
                    <h3 class="time">{{ formatDate(selectedAnnouncement.created_at) }}</h3>
                  </div>
                </div>
              </div>
            </div>
          </ng-template>
        </ion-modal>
      </div>
    </div>
  </ng-container>
  <ng-container *ngIf="visibleAnnouncements.length == 0">
    <ng-container *ngIf="isLoading">
      <div class="body">
        <ion-spinner name="crescent"></ion-spinner>
      </div> 
    </ng-container>
    <ng-container *ngIf="!isLoading">
      <div class="body">
        <div class="stmt">
          <p>No announcements</p>
          <p class="second-stmt">Announcements sent by board members will appear here</p>
          <ion-img class="no-emergencies-img" src="assets/img/no-emergencies-img.png"></ion-img>
        </div>
      </div>  
    </ng-container>
  </ng-container>
</ion-content>